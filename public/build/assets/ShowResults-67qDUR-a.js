import{d as R,r as f,c as a,o as i,a as n,F as m,f as x,t as c,i as _,W as j,h as q,u as B,n as O}from"./app-BrFhRYXM.js";import{S as g}from"./sweetalert2.esm.all-89IKscqO.js";/* empty css                        */import{r as P}from"./PencilIcon-C_EbbQJI.js";const V={class:"overflow-x-auto"},W={class:"min-w-full divide-y divide-gray-200 border rounded shadow-sm bg-white dark:bg-gray-900"},A={class:"bg-gray-100 dark:bg-gray-800 text-md font-semibold text-gray-700 dark:text-gray-200"},D={class:"flex items-center justify-between"},E=["onClick"],L={class:"px-4 py-2 text-left"},$={class:"px-4 py-2 border-gray-300 dark:border-gray-600"},T={class:"px-4 py-2"},G={key:0},z=["value","onInput"],Y={key:1},H={key:0,class:"text-gray-900 dark:text-gray-100"},J={key:1,class:"text-gray-400"},K={class:"px-4 py-2 border-gray-300 dark:border-gray-600"},M={class:"px-4 py-2 border-gray-300 dark:border-gray-600"},Q={colspan:"100%",class:"px-4 py-3 text-center bg-gray-50 dark:bg-gray-800 border-t border-gray-300 dark:border-gray-600"},U={class:"relative group inline-block"},et={__name:"ShowResults",props:{section:{type:Object,required:!0},course:{type:Object,required:!0},semester:{type:Object,required:!0},weights:{type:Array,required:!0},instructor:{type:Object,required:!0},studentsList:{type:Object,required:!0}},setup(b){const d=b,k=R(()=>d.weights.reduce((r,t)=>r+(parseFloat(t.point)||0),0));f({students:[],meta:{current_page:1,per_page:50}}),f(!1);const p=f(null),l=f({}),w=r=>{p.value=r,l.value[r]||(l.value[r]={}),setTimeout(()=>{const t=document.querySelector(`[data-weight-id="${r}"]`);t&&t.scrollIntoView({behavior:"smooth",block:"center"})},100)},v=r=>{let t=0;return d.weights.forEach(e=>{var o;if(p.value===e.id){const s=parseFloat((o=l.value[e.id])==null?void 0:o[r]);isNaN(s)||(t+=s)}else{const s=e.results.find(u=>u.student_id===r);if(s){const u=parseFloat(s.point);isNaN(u)||(t+=u)}}}),t.toFixed(2)},N=r=>{const t=parseFloat(v(r));return isNaN(t)?"N/A":t>=94?"A (4.0)":t>=90?"A- (3.7)":t>=87?"B+ (3.3)":t>=84?"B (3.0)":t>=80?"B- (2.7)":t>=77?"C+ (2.3)":t>=74?"C (2.0)":t>=70?"C- (1.7)":t>=67?"D+ (1.3)":t>=64?"D (1.0)":t>=60?"D- (0.7)":"F (0.0)"},S=(r,t)=>{var o;if(((o=l.value[t])==null?void 0:o[r])!==void 0)return l.value[t][r];const e=d.weights.find(s=>s.id===t);if(e&&e.results){const s=e.results.find(u=>u.student_id===r);return s?s.point:""}return""},F=(r,t,e)=>{l.value[t]||(l.value[t]={}),l.value[t][r]=e},C=()=>{const r=p.value,t=d.weights.find(s=>s.id===r);if(!r||!l.value[r]){g.fire({icon:"warning",title:"No active weight",text:"Please activate a weight column before submitting."});return}const e=l.value[r],o=[];for(const[s,u]of Object.entries(e)){const y=parseFloat(u);if(isNaN(y)||y<0||y>t.point){g.fire({icon:"error",title:"Invalid Input",text:`Please enter a valid point between 0 and ${t.point} for all students.`});return}o.push({instructor_id:d.instructor.id,weight_id:r,student_id:parseInt(s),point:y})}if(o.length===0){g.fire({icon:"info",title:"Nothing to Submit",text:"You haven't entered any valid results."});return}j.post(route("results.store"),{results:o},{onSuccess:()=>{g.fire({icon:"success",title:"Saved!",text:`Results for "${t.name}" saved successfully.`,timer:2e3,showConfirmButton:!1}),p.value=null},onError:()=>{g.fire({icon:"error",title:"Error",text:"Something went wrong while saving. Please try again."})}})};function h(r,t){var o;const e=(o=r.results)==null?void 0:o.find(s=>s.student_id===t);return e?e.point:null}return(r,t)=>(i(),a("div",V,[n("table",W,[n("thead",A,[n("tr",null,[t[0]||(t[0]=n("th",{class:"px-4 py-2 text-left"},"#",-1)),t[1]||(t[1]=n("th",{class:"px-4 py-2 text-left"},"Student",-1)),(i(!0),a(m,null,x(d.weights,e=>(i(),a("th",{key:e.id,class:"px-4 py-2 text-center"},[n("div",D,[n("span",null,c(e.name)+" ("+c(e.point)+"pt)",1),!p.value&&!d.section.grades||d.section.grades.filter(o=>o.course_id===d.course.id).length===0?(i(),a("button",{key:0,onClick:o=>w(e.id),class:"ml-2 text-xs text-white bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded"},[q(B(P),{class:"w-5 h-5"})],8,E)):_("",!0)])]))),128)),n("th",L,"Total ("+c(k.value)+"pt)",1),t[2]||(t[2]=n("th",{class:"px-6 py-2 text-left"},"Grade",-1))])]),n("tbody",null,[(i(!0),a(m,null,x(b.studentsList,(e,o)=>(i(),a("tr",{key:e.id,class:O([o%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-700","border-b border-gray-300 dark:border-gray-600 text-sm text-gray-600 dark:text-gray-300"])},[n("td",$,c(o+1),1),n("td",T,c(e.firstName)+" "+c(e.middleName),1),(i(!0),a(m,null,x(b.weights,s=>(i(),a("td",{key:s.id,class:"px-4 py-2 text-center border-gray-300 dark:border-gray-600"},[p.value===s.id?(i(),a("span",G,[n("input",{type:"number",step:"0.01",min:"0",max:"100",class:"px-1 py-0.5 h-7 rounded-md dark:bg-gray-800 dark:text-gray-100 text-center",value:S(e.id,s.id),onInput:u=>F(e.id,s.id,u.target.value)},null,40,z)])):(i(),a("span",Y,[h(s,e.id)!==null?(i(),a("span",H,c(h(s,e.id)),1)):(i(),a("span",J,"N/A"))]))]))),128)),n("td",K,c(v(e.id)),1),n("td",M,c(N(e.id)),1)],2))),128))]),n("tfoot",null,[n("tr",null,[n("td",Q,[n("div",U,[p.value?(i(),a("button",{key:0,onClick:C,class:"text-sm px-4 py-2 rounded text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}," Save Results ")):_("",!0)])])])])])]))}};export{et as default};
