import{h as F,r as y,c as n,o as i,a,F as b,d as m,t as p,g as v,W as B,f as R,u as j,n as q}from"./app-CfzmbECC.js";/* empty css                                                                  */import{S as f}from"./sweetalert2.esm.all-89IKscqO.js";/* empty css                        */import{r as O}from"./PencilIcon-CHQHNmIZ.js";const P={class:"overflow-x-auto"},V={class:"min-w-full divide-y divide-gray-200 border rounded shadow-sm bg-white dark:bg-gray-900"},W={class:"bg-gray-100 dark:bg-gray-800 text-md font-semibold text-gray-700 dark:text-gray-200"},A={class:"flex items-center justify-between"},D=["onClick"],E={class:"px-4 py-2 text-left"},$={class:"px-4 py-2 border-gray-300 dark:border-gray-600"},T={class:"px-4 py-2"},G={key:0},L=["value","onInput"],z={key:1},Y={key:0,class:"text-gray-900 dark:text-gray-100"},H={key:1,class:"text-gray-400"},J={class:"px-4 py-2 border-gray-300 dark:border-gray-600"},K={class:"px-4 py-2 border-gray-300 dark:border-gray-600"},M={colspan:"100%",class:"px-4 py-3 text-center bg-gray-50 dark:bg-gray-800 border-t border-gray-300 dark:border-gray-600"},Q={class:"relative group inline-block"},te={__name:"ShowResults",props:{section:{type:Object,required:!0},course:{type:Object,required:!0},semester:{type:Object,required:!0},weights:{type:Array,required:!0},instructor:{type:Object,required:!0}},setup(x){const c=x,h=F(()=>c.weights.reduce((r,e)=>r+(parseFloat(e.point)||0),0));y({data:[],meta:{current_page:1,per_page:50}}),y(!1);const g=y(null),u=y({}),k=r=>{g.value=r,u.value[r]||(u.value[r]={}),setTimeout(()=>{const e=document.querySelector(`[data-weight-id="${r}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100)},_=r=>{let e=0;return c.weights.forEach(t=>{var o;if(g.value===t.id){const s=parseFloat((o=u.value[t.id])==null?void 0:o[r]);isNaN(s)||(e+=s)}else{const s=t.results.find(l=>l.student_id===r);if(s){const l=parseFloat(s.point);isNaN(l)||(e+=l)}}}),e.toFixed(2)},w=r=>{const e=parseFloat(_(r));return isNaN(e)?"N/A":e>=94?"A (4.0)":e>=90?"A- (3.7)":e>=87?"B+ (3.3)":e>=84?"B (3.0)":e>=80?"B- (2.7)":e>=77?"C+ (2.3)":e>=74?"C (2.0)":e>=70?"C- (1.7)":e>=67?"D+ (1.3)":e>=64?"D (1.0)":e>=60?"D- (0.7)":"F (0.0)"},N=(r,e)=>{var o;if(((o=u.value[e])==null?void 0:o[r])!==void 0)return u.value[e][r];const t=c.weights.find(s=>s.id===e);if(t&&t.results){const s=t.results.find(l=>l.student_id===r);return s?s.point:""}return""},S=(r,e,t)=>{u.value[e]||(u.value[e]={}),u.value[e][r]=t},C=()=>{const r=g.value,e=c.weights.find(s=>s.id===r);if(!r||!u.value[r]){f.fire({icon:"warning",title:"No active weight",text:"Please activate a weight column before submitting."});return}const t=u.value[r],o=[];for(const[s,l]of Object.entries(t)){const d=parseFloat(l);if(isNaN(d)||d<0||d>e.point){f.fire({icon:"error",title:"Invalid Input",text:`Please enter a valid point between 0 and ${e.point} for all students.`});return}o.push({weight_id:r,student_id:parseInt(s),point:d})}if(o.length===0){f.fire({icon:"info",title:"Nothing to Submit",text:"You haven't entered any valid results."});return}B.post(route("results.store"),{results:o},{onSuccess:()=>{f.fire({icon:"success",title:"Saved!",text:`Results for "${e.name}" saved successfully.`,timer:2e3,showConfirmButton:!1}),g.value=null},onError:()=>{f.fire({icon:"error",title:"Error",text:"Something went wrong while saving. Please try again."})}})};return(r,e)=>(i(),n("div",P,[a("table",V,[a("thead",W,[a("tr",null,[e[0]||(e[0]=a("th",{class:"px-4 py-2 text-left"},"#",-1)),e[1]||(e[1]=a("th",{class:"px-4 py-2 text-left"},"Student",-1)),(i(!0),n(b,null,m(c.weights,t=>(i(),n("th",{key:t.id,class:"px-4 py-2 text-center"},[a("div",A,[a("span",null,p(t.name)+" ("+p(t.point)+"pt)",1),!g.value&&!c.section.grades||c.section.grades.filter(o=>o.course_id===c.course.id).length===0?(i(),n("button",{key:0,onClick:o=>k(t.id),class:"ml-2 text-xs text-white bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded"},[R(j(O),{class:"w-5 h-5"})],8,D)):v("",!0)])]))),128)),a("th",E,"Total ("+p(h.value)+"pt)",1),e[2]||(e[2]=a("th",{class:"px-6 py-2 text-left"},"Grade",-1))])]),a("tbody",null,[(i(!0),n(b,null,m(x.section.students.sort((t,o)=>t.first_name.localeCompare(o.first_name)),(t,o)=>(i(),n("tr",{key:t.id,class:q([o%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-700","border-b border-gray-300 dark:border-gray-600 text-sm text-gray-600 dark:text-gray-300"])},[a("td",$,p(o+1),1),a("td",T,p(t.first_name)+" "+p(t.middle_name),1),(i(!0),n(b,null,m(c.weights,s=>{var l;return i(),n("td",{key:s.id,class:"px-4 py-2 text-center border-gray-300 dark:border-gray-600"},[g.value===s.id?(i(),n("span",G,[a("input",{type:"number",step:"0.01",min:"0",max:"100",class:"px-1 py-0.5 h-7 rounded-md dark:bg-gray-800 dark:text-gray-100 text-center",value:N(t.id,s.id),onInput:d=>S(t.id,s.id,d.target.value)},null,40,L)])):(i(),n("span",z,[s.results.some(d=>d.student_id===t.id)?(i(),n("span",Y,p((l=s.results.find(d=>d.student_id===t.id))==null?void 0:l.point),1)):(i(),n("span",H,"N/A"))]))])}),128)),a("td",J,p(_(t.id)),1),a("td",K,p(w(t.id)),1)],2))),128))]),a("tfoot",null,[a("tr",null,[a("td",M,[a("div",Q,[g.value?(i(),n("button",{key:0,onClick:C,class:"text-sm px-4 py-2 rounded text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}," Save Results ")):v("",!0)])])])])])]))}};export{te as default};
