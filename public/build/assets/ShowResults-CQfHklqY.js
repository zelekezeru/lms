import{m as C,r as h,C as F,c as a,o as n,a as o,F as g,e as m,t as d,h as x,W,g as B,u as A,n as _,l as R,z as j}from"./app-DUpuGMW7.js";import{S as f}from"./sweetalert2.esm.all-89IKscqO.js";/* empty css                        */import{r as D}from"./PencilIcon-BCMqoEh1.js";const E={class:"overflow-x-auto"},L={class:"min-w-full divide-y divide-gray-200 border rounded shadow-sm bg-white dark:bg-gray-900"},O={class:"bg-gray-100 dark:bg-gray-800 text-md font-semibold text-gray-700 dark:text-gray-200"},V={class:"flex items-center justify-between"},P=["onClick"],T={class:"px-4 py-2 text-left"},$={class:"px-4 py-2"},z={class:"px-4 py-2"},G=["data-weight-id"],I={key:0},M=["max","onUpdate:modelValue"],U={key:1},q={key:0,class:"text-gray-900 dark:text-gray-100"},H={key:1,class:"text-gray-400"},J={class:"px-4 py-2"},K={class:"px-4 py-2"},Q={colspan:"100%",class:"px-4 py-3 text-center bg-gray-50 dark:bg-gray-800 border-t border-gray-300 dark:border-gray-600"},et={__name:"ShowResults",props:{section:Object,course:Object,semester:Object,weights:Array,instructor:Object,studentsList:Array,studentResults:Object},setup(v){const l=v,k=C(()=>l.weights.reduce((s,t)=>s+(parseFloat(t.point)||0),0)),u=h(null),p=h({});F(()=>{l.studentsList.forEach(s=>{p.value[s.id]={},l.weights.forEach(t=>{var r;const e=(r=l.studentResults[s.id])==null?void 0:r[t.id];p.value[s.id][t.id]=(e==null?void 0:e.point)??null})})});const w=s=>{u.value=s,setTimeout(()=>{const t=document.querySelector(`[data-weight-id="${s}"] input`);t&&(t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus())},100)},y=(s,t)=>{var e,r;return((r=(e=l.studentResults[s])==null?void 0:e[t])==null?void 0:r.point)??null},b=s=>{let t=0;return l.weights.forEach(e=>{var i;let r=(i=p.value[s])==null?void 0:i[e.id];e.id!==u.value&&(r=y(s,e.id)),t+=parseFloat(r)||0}),t.toFixed(2)},c=s=>{const t=parseFloat(b(s));return isNaN(t)?null:t>=94?"A (4.0)":t>=90?"A- (3.7)":t>=87?"B+ (3.3)":t>=84?"B (3.0)":t>=80?"B- (2.7)":t>=77?"C+ (2.3)":t>=74?"C (2.0)":t>=70?"C- (1.7)":t>=67?"D+ (1.3)":t>=64?"D (1.0)":t>=60?"D- (0.7)":"F (0.0)"},N=()=>{const s=u.value;if(!s){f.fire({icon:"warning",title:"No active weight",text:"Activate a weight column first."});return}const t=l.weights.find(r=>r.id===s),e=[];for(const r of l.studentsList){const i=parseFloat(p.value[r.id][s]);if(isNaN(i)||i<0||i>t.point){f.fire({icon:"error",title:"Invalid input",text:`Points for ${r.firstName} must be between 0 and ${t.point}`});return}e.push({instructor_id:l.instructor.id,weight_id:s,student_id:r.id,point:i})}W.post(route("results.store"),{results:e},{onSuccess:()=>{u.value=null,f.fire({icon:"success",title:"Saved!",timer:2e3,showConfirmButton:!1})},onError:()=>{f.fire({icon:"error",title:"Error",text:"Failed to save results."})}})};return(s,t)=>(n(),a("div",E,[o("table",L,[o("thead",O,[o("tr",null,[t[0]||(t[0]=o("th",{class:"px-4 py-2 text-left"},"#",-1)),t[1]||(t[1]=o("th",{class:"px-4 py-2 text-left"},"Student",-1)),(n(!0),a(g,null,m(l.weights,e=>(n(),a("th",{key:e.id,class:"px-4 py-2 text-center"},[o("div",V,[o("span",null,d(e.name)+" ("+d(e.point)+"pt)",1),u.value?x("",!0):(n(),a("button",{key:0,onClick:r=>w(e.id),class:"ml-2 text-xs text-white bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded"},[B(A(D),{class:"w-5 h-5"})],8,P))])]))),128)),o("th",T,"Total ("+d(k.value)+"pt)",1),t[2]||(t[2]=o("th",{class:"px-6 py-2 text-left"},"Grade",-1))])]),o("tbody",null,[(n(!0),a(g,null,m(l.studentsList,(e,r)=>(n(),a("tr",{key:e.id,class:_([r%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-700","border-b border-gray-300 dark:border-gray-600 text-sm text-gray-600 dark:text-gray-300"])},[o("td",$,d(r+1),1),o("td",z,d(e.firstName)+" "+d(e.middleName),1),(n(!0),a(g,null,m(l.weights,i=>(n(),a("td",{key:i.id,"data-weight-id":i.id,class:"px-4 py-2 text-center"},[u.value===i.id?(n(),a("span",I,[R(o("input",{type:"number",step:"0.01",min:"0",max:i.point,class:"px-1 py-0.5 h-7 rounded-md dark:bg-gray-800 dark:text-gray-100 text-center","onUpdate:modelValue":S=>p.value[e.id][i.id]=S},null,8,M),[[j,p.value[e.id][i.id],void 0,{number:!0}]])])):(n(),a("span",U,[y(e.id,i.id)!==null?(n(),a("span",q,d(y(e.id,i.id)),1)):(n(),a("span",H,"N/A"))]))],8,G))),128)),o("td",J,d(b(e.id)),1),o("td",K,[c(e.id)?(n(),a("span",{key:0,class:_({"text-green-600 font-semibold":c(e.id).startsWith("A"),"text-yellow-600 font-semibold":c(e.id).startsWith("B"),"text-orange-600 font-semibold":c(e.id).startsWith("C"),"text-red-600 font-semibold":c(e.id).startsWith("D")||c(e.id).startsWith("F")})},d(c(e.id)),3)):x("",!0)])],2))),128))]),o("tfoot",null,[o("tr",null,[o("td",Q,[u.value?(n(),a("button",{key:0,onClick:N,class:"text-sm px-4 py-2 rounded text-white bg-green-600 hover:bg-green-700"}," Save Results ")):x("",!0)])])])])]))}};export{et as default};
