import{m as j,r as x,c as o,o as a,a as i,F as b,e as h,t as c,h as k,W as B,g as O,u as R,n as N}from"./app-DLtq1iBM.js";import{S as g}from"./sweetalert2.esm.all-9Qm2jZ7z.js";/* empty css                        */import{r as V}from"./PencilIcon-DGsix_5b.js";const A={class:"overflow-x-auto"},D={class:"min-w-full divide-y divide-gray-200 border rounded shadow-sm bg-white dark:bg-gray-900"},E={class:"bg-gray-100 dark:bg-gray-800 text-md font-semibold text-gray-700 dark:text-gray-200"},P={class:"flex items-center justify-between"},L=["onClick"],T={class:"px-4 py-2 text-left"},$={class:"px-4 py-2"},G={class:"px-4 py-2"},q=["data-weight-id"],z={key:0},H=["value","onInput"],J={key:1},K={key:0,class:"text-gray-900 dark:text-gray-100"},M={key:1,class:"text-gray-400"},Q={class:"px-4 py-2"},U={class:"px-4 py-2"},X={colspan:"100%",class:"px-4 py-3 text-center bg-gray-50 dark:bg-gray-800 border-t border-gray-300 dark:border-gray-600"},et={__name:"ShowResults",props:{section:Object,course:Object,semester:Object,weights:Object,instructor:Object,studentsList:Object},setup(m){const d=m,w=j(()=>d.weights.reduce((s,t)=>s+(parseFloat(t.point)||0),0));x({students:[],meta:{current_page:1,per_page:50}}),x(!1);const p=x(null),l=x({}),S=s=>{p.value=s,l.value[s]||(l.value[s]={}),setTimeout(()=>{const t=document.querySelector(`[data-weight-id="${s}"] input`);t&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t&&t.focus()},100)},v=s=>{let t=0;return d.weights.forEach(e=>{var n;if(p.value===e.id){const r=parseFloat((n=l.value[e.id])==null?void 0:n[s]);isNaN(r)||(t+=r)}else{const r=e.results.find(u=>u.student_id===s);if(r){const u=parseFloat(r.point);isNaN(u)||(t+=u)}}}),t.toFixed(2)},f=s=>{const t=parseFloat(v(s));return isNaN(t)?"N/A":t>=94?"A (4.0)":t>=90?"A- (3.7)":t>=87?"B+ (3.3)":t>=84?"B (3.0)":t>=80?"B- (2.7)":t>=77?"C+ (2.3)":t>=74?"C (2.0)":t>=70?"C- (1.7)":t>=67?"D+ (1.3)":t>=64?"D (1.0)":t>=60?"D- (0.7)":"F (0.0)"},F=(s,t)=>{var n;if(((n=l.value[t])==null?void 0:n[s])!==void 0)return l.value[t][s];const e=d.weights.find(r=>r.id===t);if(e){const r=e.results.find(u=>u.student_id===s);return r?r.point:""}return""},W=(s,t,e)=>{l.value[t]||(l.value[t]={}),l.value[t][s]=e},C=()=>{const s=p.value,t=d.weights.find(r=>r.id===s);if(!s||!l.value[s]){g.fire({icon:"warning",title:"No active weight",text:"Please activate a weight column before submitting."});return}const e=l.value[s],n=[];for(const[r,u]of Object.entries(e)){const y=parseFloat(u);if(isNaN(y)||y<0||y>t.point){g.fire({icon:"error",title:"Invalid Input",text:`Enter valid points between 0 and ${t.point}.`});return}n.push({instructor_id:d.instructor.id,weight_id:s,student_id:parseInt(r),point:y})}if(n.length===0){g.fire({icon:"info",title:"Nothing to Submit",text:"No valid results entered."});return}B.post(route("results.store"),{results:n},{onSuccess:()=>{l.value[s]={},p.value=null,g.fire({icon:"success",title:"Saved!",text:"Results saved.",timer:2e3,showConfirmButton:!1})},onError:()=>{g.fire({icon:"error",title:"Error",text:"Saving failed. Try again."})}})},_=(s,t)=>{var n;const e=(n=s.results)==null?void 0:n.find(r=>r.student_id===t);return e?e.point:null};return(s,t)=>(a(),o("div",A,[i("table",D,[i("thead",E,[i("tr",null,[t[0]||(t[0]=i("th",{class:"px-4 py-2 text-left"},"#",-1)),t[1]||(t[1]=i("th",{class:"px-4 py-2 text-left"},"Student",-1)),(a(!0),o(b,null,h(d.weights,e=>(a(),o("th",{key:e.id,class:"px-4 py-2 text-center"},[i("div",P,[i("span",null,c(e.name)+" ("+c(e.point)+"pt)",1),!p.value&&(!d.section.grades||d.section.grades.filter(n=>n.course_id===d.course.id).length===0)?(a(),o("button",{key:0,onClick:n=>S(e.id),class:"ml-2 text-xs text-white bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded"},[O(R(V),{class:"w-5 h-5"})],8,L)):k("",!0)])]))),128)),i("th",T,"Total ("+c(w.value)+"pt)",1),t[2]||(t[2]=i("th",{class:"px-6 py-2 text-left"},"Grade",-1))])]),i("tbody",null,[(a(!0),o(b,null,h(m.studentsList,(e,n)=>(a(),o("tr",{key:e.id,class:N([n%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-700","border-b border-gray-300 dark:border-gray-600 text-sm text-gray-600 dark:text-gray-300"])},[i("td",$,c(n+1),1),i("td",G,c(e.firstName)+" "+c(e.middleName),1),(a(!0),o(b,null,h(m.weights,r=>(a(),o("td",{key:r.id,"data-weight-id":r.id,class:"px-4 py-2 text-center"},[p.value===r.id?(a(),o("span",z,[i("input",{type:"number",step:"0.01",min:"0",max:"100",class:"px-1 py-0.5 h-7 rounded-md dark:bg-gray-800 dark:text-gray-100 text-center",value:F(e.id,r.id),onInput:u=>W(e.id,r.id,u.target.value)},null,40,H)])):(a(),o("span",J,[_(r,e.id)!==null?(a(),o("span",K,c(_(r,e.id)),1)):(a(),o("span",M,"N/A"))]))],8,q))),128)),i("td",Q,c(v(e.id)),1),i("td",U,[i("span",{class:N({"text-green-600 font-semibold":f(e.id).startsWith("A"),"text-yellow-600 font-semibold":f(e.id).startsWith("B"),"text-orange-600 font-semibold":f(e.id).startsWith("C"),"text-red-600 font-semibold":f(e.id).startsWith("D")||f(e.id).startsWith("F")})},c(f(e.id)),3)])],2))),128))]),i("tfoot",null,[i("tr",null,[i("td",X,[p.value?(a(),o("button",{key:0,onClick:C,class:"text-sm px-4 py-2 rounded text-white bg-green-600 hover:bg-green-700"}," Save Results`` ")):k("",!0)])])])])]))}};export{et as default};
