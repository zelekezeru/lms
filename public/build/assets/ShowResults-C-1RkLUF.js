import{h as R,r as f,c as o,o as i,a as n,F as m,d as x,t as d,g as _,W as j,f as q,u as B,n as O}from"./app-DtcGZuoJ.js";/* empty css                                                                  */import{S as g}from"./sweetalert2.esm.all-89IKscqO.js";/* empty css                        */import{r as P}from"./PencilIcon-Dpnzy0WK.js";const V={class:"overflow-x-auto"},W={class:"min-w-full divide-y divide-gray-200 border rounded shadow-sm bg-white dark:bg-gray-900"},A={class:"bg-gray-100 dark:bg-gray-800 text-md font-semibold text-gray-700 dark:text-gray-200"},D={class:"flex items-center justify-between"},E=["onClick"],L={class:"px-4 py-2 text-left"},$={class:"px-4 py-2 border-gray-300 dark:border-gray-600"},T={class:"px-4 py-2"},G={key:0},z=["value","onInput"],Y={key:1},H={key:0,class:"text-gray-900 dark:text-gray-100"},J={key:1,class:"text-gray-400"},K={class:"px-4 py-2 border-gray-300 dark:border-gray-600"},M={class:"px-4 py-2 border-gray-300 dark:border-gray-600"},Q={colspan:"100%",class:"px-4 py-3 text-center bg-gray-50 dark:bg-gray-800 border-t border-gray-300 dark:border-gray-600"},U={class:"relative group inline-block"},re={__name:"ShowResults",props:{section:{type:Object,required:!0},course:{type:Object,required:!0},semester:{type:Object,required:!0},weights:{type:Array,required:!0},instructor:{type:Object,required:!0},studentsList:{type:Object,required:!0}},setup(b){const c=b,k=R(()=>c.weights.reduce((r,e)=>r+(parseFloat(e.point)||0),0));f({students:[],meta:{current_page:1,per_page:50}}),f(!1);const p=f(null),l=f({}),w=r=>{p.value=r,l.value[r]||(l.value[r]={}),setTimeout(()=>{const e=document.querySelector(`[data-weight-id="${r}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100)},v=r=>{let e=0;return c.weights.forEach(t=>{var a;if(p.value===t.id){const s=parseFloat((a=l.value[t.id])==null?void 0:a[r]);isNaN(s)||(e+=s)}else{const s=t.results.find(u=>u.student_id===r);if(s){const u=parseFloat(s.point);isNaN(u)||(e+=u)}}}),e.toFixed(2)},N=r=>{const e=parseFloat(v(r));return isNaN(e)?"N/A":e>=94?"A (4.0)":e>=90?"A- (3.7)":e>=87?"B+ (3.3)":e>=84?"B (3.0)":e>=80?"B- (2.7)":e>=77?"C+ (2.3)":e>=74?"C (2.0)":e>=70?"C- (1.7)":e>=67?"D+ (1.3)":e>=64?"D (1.0)":e>=60?"D- (0.7)":"F (0.0)"},S=(r,e)=>{var a;if(((a=l.value[e])==null?void 0:a[r])!==void 0)return l.value[e][r];const t=c.weights.find(s=>s.id===e);if(t&&t.results){const s=t.results.find(u=>u.student_id===r);return s?s.point:""}return""},F=(r,e,t)=>{l.value[e]||(l.value[e]={}),l.value[e][r]=t},C=()=>{const r=p.value,e=c.weights.find(s=>s.id===r);if(!r||!l.value[r]){g.fire({icon:"warning",title:"No active weight",text:"Please activate a weight column before submitting."});return}const t=l.value[r],a=[];for(const[s,u]of Object.entries(t)){const y=parseFloat(u);if(isNaN(y)||y<0||y>e.point){g.fire({icon:"error",title:"Invalid Input",text:`Please enter a valid point between 0 and ${e.point} for all students.`});return}a.push({weight_id:r,student_id:parseInt(s),point:y})}if(a.length===0){g.fire({icon:"info",title:"Nothing to Submit",text:"You haven't entered any valid results."});return}j.post(route("results.store"),{results:a},{onSuccess:()=>{g.fire({icon:"success",title:"Saved!",text:`Results for "${e.name}" saved successfully.`,timer:2e3,showConfirmButton:!1}),p.value=null},onError:()=>{g.fire({icon:"error",title:"Error",text:"Something went wrong while saving. Please try again."})}})};function h(r,e){var a;const t=(a=r.results)==null?void 0:a.find(s=>s.student_id===e);return t?t.point:null}return(r,e)=>(i(),o("div",V,[n("table",W,[n("thead",A,[n("tr",null,[e[0]||(e[0]=n("th",{class:"px-4 py-2 text-left"},"#",-1)),e[1]||(e[1]=n("th",{class:"px-4 py-2 text-left"},"Student",-1)),(i(!0),o(m,null,x(c.weights,t=>(i(),o("th",{key:t.id,class:"px-4 py-2 text-center"},[n("div",D,[n("span",null,d(t.name)+" ("+d(t.point)+"pt)",1),!p.value&&!c.section.grades||c.section.grades.filter(a=>a.course_id===c.course.id).length===0?(i(),o("button",{key:0,onClick:a=>w(t.id),class:"ml-2 text-xs text-white bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded"},[q(B(P),{class:"w-5 h-5"})],8,E)):_("",!0)])]))),128)),n("th",L,"Total ("+d(k.value)+"pt)",1),e[2]||(e[2]=n("th",{class:"px-6 py-2 text-left"},"Grade",-1))])]),n("tbody",null,[(i(!0),o(m,null,x(b.studentsList,(t,a)=>(i(),o("tr",{key:t.id,class:O([a%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-700","border-b border-gray-300 dark:border-gray-600 text-sm text-gray-600 dark:text-gray-300"])},[n("td",$,d(a+1),1),n("td",T,d(t.first_name)+" "+d(t.middle_name),1),(i(!0),o(m,null,x(b.weights,s=>(i(),o("td",{key:s.id,class:"px-4 py-2 text-center border-gray-300 dark:border-gray-600"},[p.value===s.id?(i(),o("span",G,[n("input",{type:"number",step:"0.01",min:"0",max:"100",class:"px-1 py-0.5 h-7 rounded-md dark:bg-gray-800 dark:text-gray-100 text-center",value:S(t.id,s.id),onInput:u=>F(t.id,s.id,u.target.value)},null,40,z)])):(i(),o("span",Y,[h(s,t.id)!==null?(i(),o("span",H,d(h(s,t.id)),1)):(i(),o("span",J,"N/A"))]))]))),128)),n("td",K,d(v(t.id)),1),n("td",M,d(N(t.id)),1)],2))),128))]),n("tfoot",null,[n("tr",null,[n("td",Q,[n("div",U,[p.value?(i(),o("button",{key:0,onClick:C,class:"text-sm px-4 py-2 rounded text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed"}," Save Results ")):_("",!0)])])])])])]))}};export{re as default};
